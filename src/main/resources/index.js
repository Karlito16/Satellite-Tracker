let map = L.map("map").setView([0, 0], 2);
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map);
let polygon = null;

const data = [
    {lat: -29.8998, lon: -94.1934, ts: 1654067236},
    {lat: -30.148, lon: -93.9219, ts: 1654067241},
    {lat: -30.3729, lon: -93.6739, ts: 1654067246},
    {lat: -30.6197, lon: -93.3996, ts: 1654067252},
    {lat: -30.8435, lon: -93.149, ts: 1654067257},
    {lat: -31.0667, lon: -92.8971, ts: 1654067262},
    {lat: -31.3116, lon: -92.6185, ts: 1654067267},
    {lat: -31.5336, lon: -92.3638, ts: 1654067272},
    {lat: -31.755, lon: -92.1079, ts: 1654067277},
    {lat: -31.9979, lon: -91.8248, ts: 1654067283},
    {lat: -32.218, lon: -91.566, ts: 1654067288},
    {lat: -32.4595, lon: -91.2798, ts: 1654067293},
    {lat: -32.6784, lon: -91.0181, ts: 1654067298},
    {lat: -32.8967, lon: -90.755, ts: 1654067303},
    {lat: -33.1359, lon: -90.4641, ts: 1654067309},
    {lat: -33.3527, lon: -90.1981, ts: 1654067314},
    {lat: -33.5904, lon: -89.904, ts: 1654067319},
    {lat: -33.8058, lon: -89.635, ts: 1654067324},
    {lat: -34.0205, lon: -89.3646, ts: 1654067329},
    {lat: -34.2559, lon: -89.0654, ts: 1654067335},
    {lat: -34.4691, lon: -88.7919, ts: 1654067340},
    {lat: -34.6816, lon: -88.5169, ts: 1654067345},
    {lat: -34.9146, lon: -88.2125, ts: 1654067351},
    {lat: -35.1256, lon: -87.9342, ts: 1654067356},
    {lat: -35.3569, lon: -87.6264, ts: 1654067361},
    {lat: -35.5663, lon: -87.3449, ts: 1654067366},
    {lat: -35.7749, lon: -87.0618, ts: 1654067371},
    {lat: -36.0035, lon: -86.7486, ts: 1654067377},
    {lat: -36.2105, lon: -86.4622, ts: 1654067382},
    {lat: -36.4373, lon: -86.1452, ts: 1654067387},
    {lat: -36.6427, lon: -85.8553, ts: 1654067392},
    {lat: -36.8472, lon: -85.5637, ts: 1654067397},
    {lat: -37.072, lon: -85.2401, ts: 165406740},
    {lat: -37.2748, lon: -84.9449, ts: 1654067408},
    {lat: -37.4971, lon: -84.6181, ts: 1654067413},
    {lat: -37.6981, lon: -84.3194, ts: 1654067418},
    {lat: -37.8982, lon: -84.019, ts: 1654067423},
    {lat: -38.1173, lon: -83.6865, ts: 1654067429},
    {lat: -38.3155, lon: -83.3825, ts: 1654067434},
    {lat: -38.5325, lon: -83.0459, ts: 1654067439},
    {lat: -38.7289, lon: -82.7381, ts: 1654067444},
    {lat: -38.9243, lon: -82.4285, ts: 1654067449},
    {lat: -39.1382, lon: -82.0858, ts: 1654067455},
    {lat: -39.3315, lon: -81.7724, ts: 1654067460},
    {lat: -39.524, lon: -81.457, ts: 1654067465},
    {lat: -39.7346, lon: -81.1079, ts: 1654067470},
    {lat: -39.925, lon: -80.7887, ts: 1654067475},
    {lat: -40.1333, lon: -80.4353, ts: 1654067481},
    {lat: -40.3217, lon: -80.1118, ts: 1654067486},
    {lat: -40.509, lon: -79.7866, ts: 1654067491},
    {lat: -40.7136, lon: -79.4268, ts: 1654067496},
    {lat: -40.8987, lon: -79.0976, ts: 1654067501},
    {lat: -41.101, lon: -78.7332, ts: 1654067507},
    {lat: -41.2837, lon: -78.3999, ts: 1654067512},
    {lat: -41.4654, lon: -78.0646, ts: 1654067517},
    {lat: -41.664, lon: -77.6934, ts: 1654067522},
    {lat: -41.8433, lon: -77.3538, ts: 1654067527},
    {lat: -42.0216, lon: -77.0122, ts: 1654067532},
    {lat: -42.2162, lon: -76.6341, ts: 1654067538},
    {lat: -42.392, lon: -76.2884, ts: 1654067543},
    {lat: -42.5839, lon: -75.9056, ts: 1654067548},
    {lat: -42.7572, lon: -75.5555, ts: 1654067553},
    {lat: -42.9293, lon: -75.2033, ts: 1654067558},
    {lat: -43.1171, lon: -74.8135, ts: 1654067564},
    {lat: -43.2866, lon: -74.4568, ts: 1654067569},
    {lat: -43.4548, lon: -74.0982, ts: 1654067574},
    {lat: -43.6384, lon: -73.7013, ts: 1654067580},
    {lat: -43.804, lon: -73.3379, ts: 1654067585},
    {lat: -43.9846, lon: -72.9361, ts: 1654067590},
    {lat: -44.1475, lon: -72.5683, ts: 1654067595},
    {lat: -44.309, lon: -72.1986, ts: 1654067600},
    {lat: -44.4851, lon: -71.7894, ts: 1654067606},
    {lat: -44.6437, lon: -71.4152, ts: 1654067611},
    {lat: -44.8166, lon: -71.0011, ts: 1654067616},
    {lat: -44.9724, lon: -70.6222, ts: 1654067621},
    {lat: -45.1268, lon: -70.2412, ts: 1654067626},
    {lat: -45.295, lon: -69.8196, ts: 1654067632},
    {lat: -45.4463, lon: -69.434, ts: 1654067637},
    {lat: -45.6111, lon: -69.0074, ts: 1654067642},
    {lat: -45.7594, lon: -68.6173, ts: 1654067647},
    {lat: -45.9062, lon: -68.2251, ts: 165406765},
    {lat: -46.0659, lon: -67.7911, ts: 1654067658},
    {lat: -46.2095, lon: -67.3943, ts: 1654067663},
    {lat: -46.3516, lon: -66.9954, ts: 1654067668},
    {lat: -46.5061, lon: -66.554, ts: 1654067673},
    {lat: -46.6449, lon: -66.1505, ts: 1654067678},
    {lat: -46.7958, lon: -65.7041, ts: 1654067684},
    {lat: -46.9313, lon: -65.2959, ts: 1654067689},
    {lat: -47.0651, lon: -64.8856, ts: 1654067694},
    {lat: -47.2105, lon: -64.4318, ts: 1654067699},
    {lat: -47.341, lon: -64.0169, ts: 1654067704},
    {lat: -47.4825, lon: -63.5581, ts: 1654067710},
    {lat: -47.6095, lon: -63.1388, ts: 1654067715},
    {lat: -47.7347, lon: -62.7174, ts: 1654067720},
    {lat: -47.8705, lon: -62.2514, ts: 1654067725},
    {lat: -47.9921, lon: -61.8255, ts: 1654067730},
    {lat: -48.1119, lon: -61.3976, ts: 1654067735},
    {lat: -48.2417, lon: -60.9246, ts: 1654067741},
    {lat: -48.3578, lon: -60.4924, ts: 1654067746},
    {lat: -48.4835, lon: -60.0146, ts: 1654067751}
];


const setPathOnMap = points => {
    polygon?.removeFrom(map);
    polygon = L.polygon(points)
    polygon.addTo(map);
}

const initMap = () => {
    setPathOnMap(data.map(record => [record.lat, record.lon]));
};

const onTrack = () => {
    const startTime = new Date(document.getElementById("timeStart").value).getTime();
    const endTime = new Date(document.getElementById("timeEnd").value).getTime();

    const filtered = data
        .filter(record => record.ts >= startTime && record.ts <= endTime)
        .map(record => [record.lat, record.lon]);

    setPathOnMap(filtered);
};

initMap();